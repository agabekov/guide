# üöÄ RAG –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è Kaspi Guide

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å **~13,000 —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**:
- –†–µ–¥–∞–∫—Ç–æ—Ä—Å–∫–∏–π —á–µ–∫–ª–∏—Å—Ç: ~8,000 —Ç–æ–∫–µ–Ω–æ–≤ (223 —Å—Ç—Ä–æ–∫–∏)
- 12 —Å–ª—É—á–∞–π–Ω—ã—Ö FAQ –ø—Ä–∏–º–µ—Ä–æ–≤: ~2,500 —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ–ª–Ω—ã–π sourceText: ~2,000-4,000 —Ç–æ–∫–µ–Ω–æ–≤

**–°—Ç–æ–∏–º–æ—Å—Ç—å**: –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 10 –æ—Ç–≤–µ—Ç–æ–≤ = **130,000+ —Ç–æ–∫–µ–Ω–æ–≤**

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ RAG (Retrieval-Augmented Generation) + —É–º–Ω–æ–µ —Å–∂–∞—Ç–∏–µ + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **RAG —Å–∏—Å—Ç–µ–º–∞** (`src/services/ragService.ts`)
   - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö FAQ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Transformers.js (multilingual-e5-small)
   - –¢–æ–ø-5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö FAQ –≤–º–µ—Å—Ç–æ 12 —Å–ª—É—á–∞–π–Ω—ã—Ö

2. **–°–∂–∞—Ç–∏–µ —á–µ–∫–ª–∏—Å—Ç–∞** (`src/services/checklistCompressor.ts`)
   - –ê–Ω–∞–ª–∏–∑ sourceText
   - –í—ã–±–æ—Ä —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å–µ–∫—Ü–∏–π
   - 75% —ç–∫–æ–Ω–æ–º–∏—è –Ω–∞ —á–µ–∫–ª–∏—Å—Ç–µ

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (`src/services/cacheService.ts`)
   - localStorage —Å TTL 24 —á–∞—Å–∞
   - 100% —ç–∫–æ–Ω–æ–º–∏—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

4. **–ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤** (`src/utils/tokenCounter.ts`)
   - –û—Ü–µ–Ω–∫–∞ –¥–æ/–ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ API

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤: 50-75%

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –≠–∫–æ–Ω–æ–º–∏—è |
|---------|-----|-------|----------|
| FAQ –ø—Ä–∏–º–µ—Ä—ã | 2,500 √ó 10 = 25,000 | 1,000 √ó 10 = 10,000 | 60% |
| –ß–µ–∫–ª–∏—Å—Ç | 8,000 √ó 10 = 80,000 | 2,000 √ó 10 = 20,000 | 75% |
| sourceText | 3,000 √ó 10 = 30,000 | 3,000 √ó 10 = 30,000 | 0% |
| **–ò–¢–û–ì–û** | **140,000 —Ç–æ–∫–µ–Ω–æ–≤** | **65,000 —Ç–æ–∫–µ–Ω–æ–≤** | **54%** |

### –° —É—á–µ—Ç–æ–º –∫—ç—à–∞:

| –°—Ü–µ–Ω–∞—Ä–∏–π | –¢–æ–∫–µ–Ω—ã | –≠–∫–æ–Ω–æ–º–∏—è |
|----------|--------|----------|
| –ü–µ—Ä–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | 65,000 | 54% |
| –ü–æ–≤—Ç–æ—Ä–Ω–∞—è (cache hit) | 0 | 100% |

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```bash
npm install
```

–í–∫–ª—é—á–∞–µ—Ç:
- `@xenova/transformers` - –¥–ª—è RAG
- `openai` - –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings:

**–í–∞—Ä–∏–∞–Ω—Ç A: –õ–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, ~30-40 –º–∏–Ω—É—Ç)**

```bash
npm run build:embeddings:local
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ OpenAI API (–±—ã—Å—Ç—Ä–æ, ~$0.20)**

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```
VITE_OPENAI_API_KEY=sk-...
```

–ó–∞—Ç–µ–º:
```bash
npm run build:embeddings
```

### 3. –ó–∞–ø—É—Å–∫:

```bash
npm run dev
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤:

```typescript
// –î–æ: 12 —Å–ª—É—á–∞–π–Ω—ã—Ö FAQ
const examples = pickStyleExamples(faqData, 12);

// –ü–æ—Å–ª–µ: 5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö FAQ —á–µ—Ä–µ–∑ RAG
const relevantFAQs = await findSimilarFAQs(sourceText, 5);
const compressedChecklist = compressChecklist(sourceText, editorGuidelines);
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤:

```typescript
// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
const cached = getCachedAnswers(cacheKey);
if (cached) return cached; // 100% —ç–∫–æ–Ω–æ–º–∏—è!

// 2. RAG –ø–æ–∏—Å–∫ (–û–î–ò–ù –†–ê–ó –¥–ª—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
const relevantFAQs = await findSimilarFAQs(sourceText, 5);

// 3. –°–∂–∞—Ç–∏–µ —á–µ–∫–ª–∏—Å—Ç–∞ (–û–î–ò–ù –†–ê–ó)
const compressedChecklist = compressChecklist(sourceText, editorGuidelines);

// 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
for (const question of questions) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  const answer = await generateAnswer(question);
}

// 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
setCachedAnswers(cacheKey, results);
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```
üöÄ Starting answer generation for 10 questions...
üíæ Cache miss - generating new answers...
üîç Finding similar FAQs using RAG (once for all questions)...
   ‚úì Found 5 similar FAQs in 1.2s
üóúÔ∏è  Compressing checklist (once for all questions)...
   ‚úì Saved 72.5% of checklist size

üí∞ Answer Generation - Detailed Token & Cost Statistics:
   Before: 140.0K tokens ($0.038)
   After:  65.0K tokens ($0.018)
   Saved:  75.0K tokens ($0.020) - 53.6% reduction

üìù Generating answers for 10 questions...
   Question 1/10: –ö–∞–∫ –≤–Ω–µ—Å—Ç–∏ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂...
   ‚úÖ Answer 1/10 generated successfully
   ...

‚úÖ All answers generated successfully
üíæ Caching results for future use...
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
kaspi-guide/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ groqService.ts          # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚ú®
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ragService.ts           # RAG —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checklistCompressor.ts  # –°–∂–∞—Ç–∏–µ —á–µ–∫–ª–∏—Å—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cacheService.ts         # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tokenCounter.ts         # –ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ data/
‚îÇ       ‚îú‚îÄ‚îÄ faq.json                # 3,981 FAQ
‚îÇ       ‚îî‚îÄ‚îÄ faq-embeddings.json     # –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ embeddings
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ generateEmbeddings.ts       # OpenAI –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ generateEmbeddingsLocal.ts  # –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚úÖ
‚îî‚îÄ‚îÄ package.json
```

## FAQ

### Q: –ù—É–∂–Ω–æ –ª–∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å embeddings –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö FAQ?

**A**: –î–∞, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (>100 FAQ). –î–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ —Å–æ —Å—Ç–∞—Ä—ã–º–∏ embeddings.

### Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å RAG –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–∂–∞—Ç–∏–µ?

**A**: –î–∞. –í `groqService.ts` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤—ã–∑–æ–≤—ã `findSimilarFAQs()` –∏ –≤–µ—Ä–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π `pickStyleExamples()`. –°–∂–∞—Ç–∏–µ —á–µ–∫–ª–∏—Å—Ç–∞ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

### Q: –ö–∞–∫–æ–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ embeddings?

**A**: ~2-3 MB –ø–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è gzip –±—Ä–∞—É–∑–µ—Ä–æ–º. –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 2-3 —Å–µ–∫—É–Ω–¥—ã, –∑–∞—Ç–µ–º –∫—ç—à–∏—Ä—É–µ—Ç—Å—è.

### Q: –í–ª–∏—è–µ—Ç –ª–∏ —ç—Ç–æ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏?

**A**: –ù–µ—Ç, –∫–∞—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–µ—Ç—Å—è –≤—ã—Å–æ–∫–∏–º –∏–ª–∏ –¥–∞–∂–µ —É–ª—É—á—à–∞–µ—Ç—Å—è, —Ç.–∫. RAG –≤—ã–±–∏—Ä–∞–µ—Ç –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:

1. **Token savings** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç —ç–∫–æ–Ω–æ–º–∏–∏
2. **Cache hit rate** - –∫–∞–∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à
3. **RAG similarity** - –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –Ω–∞–π–¥–µ–Ω–Ω—ã–µ FAQ

## Troubleshooting

### –û—à–∏–±–∫–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π"

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `faq-embeddings.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
```bash
ls -lh src/data/faq-embeddings.json
```

–ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
npm run build:embeddings:local
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ Transformers.js (~118 MB)

**–†–µ—à–µ–Ω–∏–µ**: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ú–æ–¥–µ–ª—å –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.

### localStorage –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω

**–ü—Ä–∏—á–∏–Ω–∞**: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –í—Ä—É—á–Ω—É—é:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
localStorage.clear()
```

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –§–∞–∑–∞ 2 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
1. **Backend RAG** (Supabase + Vercel) - –¥–ª—è –µ—â–µ –±–æ–ª—å—à–µ–π —ç–∫–æ–Ω–æ–º–∏–∏
2. **–ë–∞—Ç—á–∏–Ω–≥ –≤–æ–ø—Ä–æ—Å–æ–≤** - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
3. **Fine-tuning –ø—Ä–æ–º–ø—Ç–æ–≤** - –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
4. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ (Must Have):
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤ ‚â• 50% (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ: 54%)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ —É—Ö—É–¥—à–∏–ª–æ—Å—å
- ‚úÖ –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚â§ +20% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (Nice to Have):
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤ ‚â• 70% —Å –∫—ç—à–µ–º
- ‚úÖ Bundle size ‚â§ +15 MB
- ‚úÖ –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ RAG ‚â§ 5 —Å–µ–∫

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–í–æ–ø—Ä–æ—Å—ã? –ü—Ä–æ–±–ª–µ–º—ã? –û—Ç–∫—Ä–æ–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

**–°–æ–∑–¥–∞–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Claude Code**
