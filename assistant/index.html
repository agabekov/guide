<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ассистент контент-менеджера | Kaspi Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // ===== API Configuration =====
        const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';
        const OPENROUTER_API_URL = 'https://openrouter.ai/api/v1/chat/completions';

        // Model configurations (same as kaspi-guide)
        const MODEL_CONFIGS = [
          // Groq models (fast and free)
          { name: 'llama-3.3-70b-versatile', provider: 'groq', displayName: 'LLaMA 3.3 70B' },
          { name: 'meta-llama/llama-4-scout-17b-16e-instruct', provider: 'groq', displayName: 'LLaMA 4 Scout' },
          { name: 'llama-3.1-8b-instant', provider: 'groq', displayName: 'LLaMA 3.1 8B' },

          // OpenRouter models (fallback)
          { name: 'meta-llama/llama-3.3-70b-instruct', provider: 'openrouter', displayName: 'LLaMA 3.3 70B (OR)' },
          { name: 'google/gemini-2.0-flash-exp:free', provider: 'openrouter', displayName: 'Gemini 2.0 Flash' },
        ];

        // API Keys management (using localStorage)
        const getApiKey = (provider) => {
          return localStorage.getItem(`${provider}_api_key`) || '';
        };

        const setApiKey = (provider, key) => {
          localStorage.setItem(`${provider}_api_key`, key);
        };

        // Get available models based on configured API keys
        const getAvailableModels = () => {
          return MODEL_CONFIGS.filter(config => {
            const apiKey = getApiKey(config.provider);
            return apiKey && apiKey.trim() !== '';
          });
        };

        // Universal API call function (supports both Groq and OpenRouter)
        const callAPI = async (messages, modelConfig) => {
          const { name: modelName, provider } = modelConfig;
          const apiUrl = provider === 'groq' ? GROQ_API_URL : OPENROUTER_API_URL;
          const apiKey = getApiKey(provider);

          if (!apiKey) {
            throw new Error(`API ключ для ${provider} не настроен. Пожалуйста, добавьте ключ в настройках.`);
          }

          const headers = {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json',
          };

          // OpenRouter requires additional headers
          if (provider === 'openrouter') {
            headers['HTTP-Referer'] = window.location.origin;
            headers['X-Title'] = 'Kaspi Guide Assistant';
          }

          const response = await fetch(apiUrl, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              model: modelName,
              messages: messages,
              temperature: 0.7,
              max_tokens: 2048,
            }),
          });

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            const errorMessage = errorData.error?.message || response.statusText;
            throw new Error(`${provider} API Error: ${response.status} - ${errorMessage}`);
          }

          const data = await response.json();
          return data.choices[0]?.message?.content || '';
        };

        // Generate text using AI with automatic model fallback
        const generateTextWithAI = async (prompt) => {
          const availableModels = getAvailableModels();

          if (availableModels.length === 0) {
            throw new Error('Не настроен ни один API ключ. Пожалуйста, добавьте ключ Groq или OpenRouter в настройках.');
          }

          let lastError = null;

          // Try each available model
          for (const modelConfig of availableModels) {
            try {
              const result = await callAPI([
                { role: 'user', content: prompt }
              ], modelConfig);
              return result;
            } catch (error) {
              lastError = error;
              continue; // Try next model
            }
          }

          throw new Error(`Не удалось сгенерировать текст: ${lastError?.message || 'Попробуйте еще раз'}`);
        };

        // Lucide Icons as React components
        const AlertCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
        );

        const CheckCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
        );

        const Download = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
        );

        const Copy = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="23 4 23 10 17 10"/>
                <polyline points="1 20 1 14 7 14"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
        );

        const Upload = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
        );

        const ChevronDown = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="6 9 12 15 18 9"/>
            </svg>
        );

        const ChevronUp = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="18 15 12 9 6 15"/>
            </svg>
        );

        const Settings = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m8.66-13.66l-4.24 4.24m-4.24 4.24l-4.24 4.24M23 12h-6m-6 0H1m17.66 8.66l-4.24-4.24m-4.24-4.24l-4.24-4.24"/>
            </svg>
        );

        const X = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        // Settings Modal Component
        const SettingsModal = ({ isOpen, onClose }) => {
          const [groqKey, setGroqKey] = useState(getApiKey('groq'));
          const [openrouterKey, setOpenrouterKey] = useState(getApiKey('openrouter'));

          const handleSave = () => {
            setApiKey('groq', groqKey);
            setApiKey('openrouter', openrouterKey);
            onClose();
          };

          if (!isOpen) return null;

          return (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
              <div className="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 animate-fade-in">
                <div className="flex items-center justify-between mb-6">
                  <h2 className="text-2xl font-bold text-gray-900">Настройки API</h2>
                  <button
                    onClick={onClose}
                    className="text-gray-400 hover:text-gray-600 transition-colors"
                  >
                    <X className="w-6 h-6" />
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-900 mb-2">
                      Groq API Key
                    </label>
                    <input
                      type="password"
                      value={groqKey}
                      onChange={(e) => setGroqKey(e.target.value)}
                      placeholder="gsk_..."
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                    />
                    <p className="text-xs text-gray-500 mt-1">
                      Получите ключ на <a href="https://console.groq.com" target="_blank" className="text-blue-600 hover:underline">console.groq.com</a>
                    </p>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-900 mb-2">
                      OpenRouter API Key
                    </label>
                    <input
                      type="password"
                      value={openrouterKey}
                      onChange={(e) => setOpenrouterKey(e.target.value)}
                      placeholder="sk-or-v1-..."
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                    />
                    <p className="text-xs text-gray-500 mt-1">
                      Получите ключ на <a href="https://openrouter.ai/keys" target="_blank" className="text-blue-600 hover:underline">openrouter.ai</a>
                    </p>
                  </div>

                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p className="text-xs text-blue-900">
                      <strong>Совет:</strong> Для работы достаточно одного ключа. Groq предлагает быстрые и бесплатные модели.
                    </p>
                  </div>
                </div>

                <div className="mt-6 flex gap-3">
                  <button
                    onClick={handleSave}
                    className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                  >
                    Сохранить
                  </button>
                  <button
                    onClick={onClose}
                    className="bg-gray-100 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-200 transition-colors"
                  >
                    Отмена
                  </button>
                </div>
              </div>
            </div>
          );
        };

        const ContentAssistant = () => {
          const [inputText, setInputText] = useState('');
          const [comments, setComments] = useState('');
          const [isChecking, setIsChecking] = useState(false);
          const [checkResult, setCheckResult] = useState(null);
          const [additionalComment, setAdditionalComment] = useState('');
          const [isApplyingComment, setIsApplyingComment] = useState(false);
          const [iterationCount, setIterationCount] = useState(0);
          const [showDetailedChanges, setShowDetailedChanges] = useState(true);
          const [copiedNotification, setCopiedNotification] = useState(false);
          const [showSettings, setShowSettings] = useState(false);
          const fileInputRef = useRef(null);

          // Реальная проверка текста с использованием AI
          const handleCheckText = async () => {
            setIsChecking(true);
            setIterationCount(prev => prev + 1);

            try {
              // Проверяем наличие API ключей
              const availableModels = getAvailableModels();
              if (availableModels.length === 0) {
                alert('Пожалуйста, настройте API ключи в настройках перед использованием.');
                setShowSettings(true);
                setIsChecking(false);
                return;
              }

              // Формируем промпт для проверки текста
              const prompt = `Ты - редактор контента для Kaspi Гид. Проанализируй и улучши следующий вопрос и ответ.

ИСХОДНЫЙ ТЕКСТ:
${inputText}

${comments ? `КОММЕНТАРИИ ОТ ПОЛЬЗОВАТЕЛЯ:\n${comments}\n` : ''}

ТРЕБОВАНИЯ:
1. Исправь терминологию (используй официальные названия продуктов Kaspi)
2. Улучши SEO (добавь ключевые слова)
3. Структурируй ответ (используй нумерованные списки для инструкций)
4. Упрости формулировки
5. Добавь конкретику (сроки, условия)

ФОРМАТ ОТВЕТА (строго JSON):
{
  "correctedQuestion": "исправленный вопрос",
  "correctedAnswer": "исправленный ответ",
  "changes": [
    {
      "category": "SEO|Терминология|Структура|Стиль",
      "type": "critical|style|seo",
      "description": "описание изменения",
      "before": "текст до",
      "after": "текст после",
      "checklistItem": "пункт чеклиста"
    }
  ],
  "complianceScore": 0-100,
  "seoScore": 0-10
}

Верни ТОЛЬКО JSON, без дополнительного текста.`;

              const response = await generateTextWithAI(prompt);

              // Парсим JSON из ответа
              const jsonMatch = response.match(/\{[\s\S]*\}/);
              if (!jsonMatch) {
                throw new Error('AI вернул некорректный формат ответа');
              }

              const result = JSON.parse(jsonMatch[0]);

              // Добавляем метаданные
              result.originalText = inputText;
              result.appliedComments = comments ? [comments] : [];

              setCheckResult(result);
            } catch (error) {
              alert(`Ошибка при проверке текста: ${error.message}`);
              console.error(error);
            } finally {
              setIsChecking(false);
            }
          };

          // Применение дополнительного комментария с использованием AI
          const handleApplyComment = async () => {
            if (!additionalComment.trim()) return;

            setIsApplyingComment(true);
            setIterationCount(prev => prev + 1);

            try {
              const prompt = `Ты - редактор контента для Kaspi Гид. Доработай текст с учётом комментария пользователя.

ТЕКУЩИЙ ВОПРОС:
${checkResult.correctedQuestion}

ТЕКУЩИЙ ОТВЕТ:
${checkResult.correctedAnswer}

КОММЕНТАРИЙ ДЛЯ ДОРАБОТКИ:
${additionalComment}

ТРЕБОВАНИЯ:
1. Внеси изменения согласно комментарию
2. Сохрани качество и стиль текста
3. Не ухудшай SEO
4. Верни доработанный текст

ФОРМАТ ОТВЕТА (строго JSON):
{
  "correctedQuestion": "доработанный вопрос",
  "correctedAnswer": "доработанный ответ",
  "changes": [
    {
      "category": "категория",
      "type": "critical|style|seo",
      "description": "что изменилось",
      "before": "до",
      "after": "после",
      "checklistItem": "пункт"
    }
  ]
}

Верни ТОЛЬКО JSON, без дополнительного текста.`;

              const response = await generateTextWithAI(prompt);

              // Парсим JSON из ответа
              const jsonMatch = response.match(/\{[\s\S]*\}/);
              if (!jsonMatch) {
                throw new Error('AI вернул некорректный формат ответа');
              }

              const result = JSON.parse(jsonMatch[0]);

              // Обновляем результат с учётом новых изменений
              const updatedResult = {
                ...checkResult,
                correctedQuestion: result.correctedQuestion,
                correctedAnswer: result.correctedAnswer,
                changes: [...checkResult.changes, ...result.changes],
                appliedComments: [...checkResult.appliedComments, additionalComment]
              };

              setCheckResult(updatedResult);
              setAdditionalComment('');
            } catch (error) {
              alert(`Ошибка при доработке текста: ${error.message}`);
              console.error(error);
            } finally {
              setIsApplyingComment(false);
            }
          };

          // Копирование результата
          const handleCopy = () => {
            const textToCopy = `${checkResult.correctedQuestion}\n\n${checkResult.correctedAnswer}`;
            navigator.clipboard.writeText(textToCopy);
            setCopiedNotification(true);
            setTimeout(() => setCopiedNotification(false), 2000);
          };

          // Скачивание DOCX (имитация)
          const handleDownload = () => {
            // В реальной версии здесь будет генерация .docx
            alert('В финальной версии здесь будет скачивание .docx файла');
          };

          // Загрузка файла (имитация)
          const handleFileUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
              // В реальной версии здесь будет парсинг .docx
              setInputText(`Как получить золотую карту?\n\nНеобходимо осуществить заполнение анкеты в мобильном приложении Kaspi.kz. После этого нужно дождаться одобрения. Карту доставят бесплатно.`);
            }
          };

          // Новая проверка
          const handleNewCheck = () => {
            if (checkResult && !window.confirm('Начать новую проверку? Несохранённые данные будут потеряны.')) {
              return;
            }
            setInputText('');
            setComments('');
            setCheckResult(null);
            setAdditionalComment('');
            setIterationCount(0);
            setShowDetailedChanges(false);
          };

          const getChangeIcon = (type) => {
            switch(type) {
              case 'critical': return <AlertCircle className="w-4 h-4 text-red-500" />;
              case 'style': return <AlertCircle className="w-4 h-4 text-yellow-500" />;
              case 'seo': return <AlertCircle className="w-4 h-4 text-blue-500" />;
              default: return <AlertCircle className="w-4 h-4 text-gray-500" />;
            }
          };

          const criticalCount = checkResult?.changes.filter(c => c.type === 'critical').length || 0;
          const styleCount = checkResult?.changes.filter(c => c.type === 'style').length || 0;
          const seoCount = checkResult?.changes.filter(c => c.type === 'seo').length || 0;

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6">
              <div className="max-w-5xl mx-auto">
                {/* Header */}
                <div className="mb-8">
                  <div className="flex items-start justify-between">
                    <div>
                      <h1 className="text-3xl font-bold text-gray-900 mb-2">Ассистент контент-менеджера</h1>
                      <p className="text-gray-600">Автоматическая проверка вопросов и ответов на соответствие стандартам Kaspi Гид</p>
                    </div>
                    <button
                      onClick={() => setShowSettings(true)}
                      className="flex items-center gap-2 bg-white text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-50 border border-gray-300 transition-all shadow-sm"
                    >
                      <Settings className="w-5 h-5" />
                      Настройки
                    </button>
                  </div>
                </div>

                {/* Settings Modal */}
                <SettingsModal
                  isOpen={showSettings}
                  onClose={() => setShowSettings(false)}
                />

                {/* Step 1: Input */}
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm">1</div>
                    <h2 className="text-xl font-semibold text-gray-900">Введите текст для проверки</h2>
                  </div>

                  <div className="mb-4">
                    <div className="flex items-center justify-between mb-3">
                      <label className="block text-sm font-semibold text-gray-900">
                        Вопрос и ответ
                      </label>
                      <button
                        onClick={() => fileInputRef.current?.click()}
                        className="flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 transition-colors"
                      >
                        <Upload className="w-4 h-4" />
                        Загрузить .docx
                      </button>
                      <input
                        ref={fileInputRef}
                        type="file"
                        accept=".docx"
                        onChange={handleFileUpload}
                        className="hidden"
                      />
                    </div>
                    <textarea
                      value={inputText}
                      onChange={(e) => setInputText(e.target.value)}
                      placeholder="Вставьте вопрос и ответ"
                      className="w-full h-48 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"
                      maxLength={3000}
                    />
                    <div className="flex justify-between items-center mt-2">
                      <span className="text-xs text-gray-500">
                        AI автоматически определит вопрос и ответ
                      </span>
                      <span className="text-xs text-gray-500">
                        {inputText.length} / 3000
                      </span>
                    </div>
                  </div>

                  <div className="mb-4">
                    <label className="block text-sm font-semibold text-gray-900 mb-2">
                      Комментарии для AI <span className="text-gray-400 font-normal">(необязательно)</span>
                    </label>
                    <textarea
                      value={comments}
                      onChange={(e) => setComments(e.target.value)}
                      placeholder='Например: "Сделай короче", "Добавь информацию о сроках", "Упрости формулировки"'
                      className="w-full h-20 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"
                      maxLength={1000}
                    />
                    <div className="flex justify-between items-center mt-2">
                      <span className="text-xs text-gray-500">
                        AI учтёт ваши комментарии при проверке
                      </span>
                      <span className="text-xs text-gray-500">
                        {comments.length} / 1000
                      </span>
                    </div>
                  </div>

                  <div className="flex gap-3">
                    <button
                      onClick={handleCheckText}
                      disabled={!inputText.trim() || isChecking}
                      className="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all shadow-sm hover:shadow-md disabled:shadow-none flex items-center justify-center gap-2"
                    >
                      {isChecking ? (
                        <>
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          {comments.trim() ? 'Проверяем ваш текст с учётом комментариев...' : 'Проверяем ваш текст...'}
                        </>
                      ) : (
                        'Проверить текст'
                      )}
                    </button>

                    {checkResult && (
                      <button
                        onClick={handleNewCheck}
                        className="bg-white text-gray-700 py-3 px-6 rounded-lg font-medium hover:bg-gray-50 border border-gray-300 transition-all flex items-center justify-center gap-2"
                      >
                        <RefreshCw className="w-5 h-5" />
                        Новая проверка
                      </button>
                    )}
                  </div>
                </div>

                {/* Step 2: Results */}
                {checkResult && (
                  <>
                    {/* Status Overview */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="w-8 h-8 rounded-full bg-green-600 text-white flex items-center justify-center">
                          <CheckCircle className="w-5 h-5" />
                        </div>
                        <h2 className="text-xl font-semibold text-gray-900">Результаты проверки</h2>
                      </div>

                      <div className="grid grid-cols-3 gap-4 mb-4">
                        <div className="bg-green-50 rounded-lg p-4 text-center">
                          <div className="text-3xl font-bold text-green-600">{checkResult.complianceScore}%</div>
                          <div className="text-xs text-green-700 mt-1">Соответствие стандартам</div>
                        </div>
                        <div className="bg-blue-50 rounded-lg p-4 text-center">
                          <div className="text-3xl font-bold text-blue-600">{checkResult.seoScore}/10</div>
                          <div className="text-xs text-blue-700 mt-1">SEO-оценка</div>
                        </div>
                        <div className="bg-purple-50 rounded-lg p-4 text-center">
                          <div className="text-3xl font-bold text-purple-600">{checkResult.changes.length}</div>
                          <div className="text-xs text-purple-700 mt-1">Исправлений</div>
                        </div>
                      </div>

                      {iterationCount > 0 && (
                        <div className="text-sm text-gray-600 mb-3">
                          <span className="font-medium">Итерация:</span> {iterationCount}
                        </div>
                      )}

                      {checkResult.appliedComments.length > 0 && (
                        <div className="bg-blue-50 rounded-lg p-3">
                          <div className="text-xs font-semibold text-blue-900 mb-2">Учтены комментарии:</div>
                          {checkResult.appliedComments.map((comment, idx) => (
                            <div key={idx} className="text-xs text-blue-700 mb-1">• {comment}</div>
                          ))}
                        </div>
                      )}

                      <div className="mt-4 flex items-center gap-4 text-sm">
                        <span className="font-medium text-gray-900">Типы исправлений:</span>
                        {criticalCount > 0 && (
                          <div className="flex items-center gap-1">
                            <div className="w-3 h-3 rounded-full bg-red-500"></div>
                            <span className="text-gray-700">{criticalCount} критических</span>
                          </div>
                        )}
                        {styleCount > 0 && (
                          <div className="flex items-center gap-1">
                            <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                            <span className="text-gray-700">{styleCount} стилистических</span>
                          </div>
                        )}
                        {seoCount > 0 && (
                          <div className="flex items-center gap-1">
                            <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                            <span className="text-gray-700">{seoCount} SEO</span>
                          </div>
                        )}
                      </div>
                    </div>

                    {/* Side-by-side Comparison */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm">2</div>
                        <h2 className="text-xl font-semibold text-gray-900">Сравнение: Было → Стало</h2>
                      </div>

                      <div className="grid grid-cols-2 gap-6">
                        {/* Before */}
                        <div>
                          <div className="flex items-center gap-2 mb-3">
                            <div className="text-sm font-bold text-red-700 bg-red-50 px-3 py-1 rounded-full">БЫЛО</div>
                          </div>
                          <div className="bg-red-50 rounded-lg p-4 border-2 border-red-200 min-h-[300px]">
                            <div className="text-base font-bold text-gray-900 mb-3 whitespace-pre-wrap">
                              {checkResult.originalText.split('\n\n')[0] || 'Как получить золотую карту?'}
                            </div>
                            <div className="text-sm text-gray-700 whitespace-pre-wrap leading-relaxed">
                              {checkResult.originalText.split('\n\n').slice(1).join('\n\n') || 'Необходимо осуществить заполнение анкеты в мобильном приложении Kaspi.kz. После этого нужно дождаться одобрения. Карту доставят бесплатно.'}
                            </div>
                          </div>
                        </div>

                        {/* After */}
                        <div>
                          <div className="flex items-center gap-2 mb-3">
                            <div className="text-sm font-bold text-green-700 bg-green-50 px-3 py-1 rounded-full">СТАЛО</div>
                          </div>
                          <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200 min-h-[300px]">
                            <div className="text-base font-bold text-gray-900 mb-3">
                              {checkResult.correctedQuestion}
                            </div>
                            <div className="text-sm text-gray-700 whitespace-pre-wrap leading-relaxed">
                              {checkResult.correctedAnswer}
                            </div>
                          </div>
                        </div>
                      </div>

                      <div className="mt-6 flex gap-3">
                        <button
                          onClick={handleCopy}
                          className="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-all flex items-center justify-center gap-2"
                        >
                          <Copy className="w-5 h-5" />
                          Копировать исправленный текст
                        </button>
                        <button
                          onClick={handleDownload}
                          className="bg-white text-gray-700 py-3 px-6 rounded-lg font-medium hover:bg-gray-50 border border-gray-300 transition-all flex items-center justify-center gap-2"
                        >
                          <Download className="w-5 h-5" />
                          Скачать .docx
                        </button>
                      </div>
                    </div>

                    {/* Detailed Changes */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                      <button
                        onClick={() => setShowDetailedChanges(!showDetailedChanges)}
                        className="w-full flex items-center justify-between mb-4"
                      >
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm">3</div>
                          <h2 className="text-xl font-semibold text-gray-900">Детализация изменений ({checkResult.changes.length})</h2>
                        </div>
                        {showDetailedChanges ? <ChevronUp className="w-6 h-6 text-gray-600" /> : <ChevronDown className="w-6 h-6 text-gray-600" />}
                      </button>

                      {showDetailedChanges && (
                        <div className="space-y-4">
                          {checkResult.changes.map((change, idx) => (
                            <div key={idx} className="border border-gray-200 rounded-lg p-4">
                              <div className="flex items-start gap-3 mb-3">
                                {getChangeIcon(change.type)}
                                <div className="flex-1">
                                  <div className="flex items-center gap-2 mb-1">
                                    <span className="text-sm font-bold text-gray-900">{change.category}</span>
                                    <span className="text-xs text-gray-500">• {change.checklistItem}</span>
                                  </div>
                                  <div className="text-sm text-gray-700">{change.description}</div>
                                </div>
                              </div>

                              <div className="grid grid-cols-2 gap-4">
                                <div>
                                  <div className="text-xs font-semibold text-red-700 mb-2">Было:</div>
                                  <div className="bg-red-50 rounded p-3 border border-red-200">
                                    <div className="text-sm text-red-900">{change.before}</div>
                                  </div>
                                </div>
                                <div>
                                  <div className="text-xs font-semibold text-green-700 mb-2">Стало:</div>
                                  <div className="bg-green-50 rounded p-3 border border-green-200">
                                    <div className="text-sm text-green-900">{change.after}</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>

                    {/* Additional Comments */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm">4</div>
                        <h2 className="text-xl font-semibold text-gray-900">Доработка текста</h2>
                      </div>

                      <label className="block text-sm font-semibold text-gray-900 mb-2">
                        Комментарий для доработки
                      </label>
                      <textarea
                        value={additionalComment}
                        onChange={(e) => setAdditionalComment(e.target.value)}
                        placeholder="Укажите, что нужно изменить или добавить"
                        className="w-full h-24 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"
                        maxLength={1000}
                      />
                      <div className="flex justify-between items-center mt-2 mb-4">
                        <span className="text-xs text-gray-500">
                          AI доработает текст с учётом комментария
                        </span>
                        <span className="text-xs text-gray-500">
                          {additionalComment.length} / 1000
                        </span>
                      </div>
                      <button
                        onClick={handleApplyComment}
                        disabled={!additionalComment.trim() || isApplyingComment}
                        className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2"
                      >
                        {isApplyingComment ? (
                          <>
                            <RefreshCw className="w-5 h-5 animate-spin" />
                            Дорабатываем текст...
                          </>
                        ) : (
                          'Применить комментарий'
                        )}
                      </button>
                    </div>
                  </>
                )}

                {/* Notification */}
                {copiedNotification && (
                  <div className="fixed bottom-6 right-6 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 animate-fade-in z-50">
                    <CheckCircle className="w-5 h-5" />
                    Скопировано!
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<ContentAssistant />, document.getElementById('root'));
    </script>
</body>
</html>
