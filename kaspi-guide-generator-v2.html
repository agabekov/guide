<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ | Kaspi –ì–∏–¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #1a202c;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            color: #718096;
            font-size: 14px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .card.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-title {
            font-size: 22px;
            color: #1a202c;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .card-subtitle {
            color: #718096;
            margin-bottom: 24px;
            font-size: 14px;
        }

        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .upload-area.drag-over {
            border-color: #667eea;
            background: #edf2f7;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
            margin-bottom: 16px;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .file-list {
            margin-top: 24px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .file-icon {
            font-size: 24px;
        }

        .file-details {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 500;
            color: #1a202c;
            font-size: 14px;
        }

        .file-size {
            font-size: 12px;
            color: #718096;
        }

        .remove-btn {
            background: none;
            border: none;
            color: #e53e3e;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .remove-btn:hover {
            background: #fee;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #edf2f7;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #4a5568;
            font-size: 16px;
        }

        .question-item {
            padding: 16px;
            background: #f7fafc;
            border-radius: 10px;
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transition: all 0.2s;
        }

        .question-item:hover {
            background: #edf2f7;
        }

        .question-item.editing {
            background: #fff;
            border: 2px solid #667eea;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .question-content {
            flex: 1;
        }

        .question-number {
            font-weight: 600;
            color: #667eea;
            margin-right: 8px;
        }

        .question-text {
            color: #1a202c;
            font-size: 15px;
            cursor: pointer;
        }

        .question-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
        }

        .add-question {
            margin-top: 16px;
        }

        .add-question input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 15px;
        }

        .add-question input:focus {
            outline: none;
            border-color: #667eea;
        }

        .result-block {
            margin-bottom: 32px;
        }

        .qa-pair {
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            margin-bottom: 16px;
            border-left: 4px solid #667eea;
        }

        .qa-question {
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .qa-answer {
            color: #4a5568;
            line-height: 1.6;
            font-size: 15px;
        }

        .edit-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
        }

        .edit-label {
            font-size: 13px;
            color: #718096;
            margin-bottom: 8px;
            display: block;
        }

        .edit-textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
        }

        .edit-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .export-area {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            background: #48bb78;
            color: white;
            padding: 16px 24px;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
            }
            to {
                transform: translateX(0);
            }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge.edited {
            background: #f59e0b;
        }

        .edit-icon {
            color: #f59e0b;
            margin-left: 8px;
        }

        .content-preview {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 16px;
            margin-top: 16px;
            max-height: 200px;
            overflow-y: auto;
        }

        .content-preview-title {
            font-size: 13px;
            color: #718096;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .content-preview-text {
            font-size: 13px;
            color: #4a5568;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤</h1>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ FAQ –¥–ª—è Kaspi –ì–∏–¥ —Å –ø–æ–º–æ—â—å—é AI</p>
        </div>

        <!-- –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
        <div class="card active" id="step1">
            <div class="card-title">–®–∞–≥ 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥—É–∫—Ç–µ</div>
            <div class="card-subtitle">–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>

            <textarea id="infoText" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥—É–∫—Ç–µ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏...
–ù–∞–ø—Ä–∏–º–µ—Ä: –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏"></textarea>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <div style="font-size: 16px; color: #1a202c; margin-bottom: 8px;">
                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞
                </div>
                <div style="font-size: 13px; color: #718096;">
                    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: .docx, .pdf (–¥–æ 10 –ú–ë) –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è .jpg, .png (–¥–æ 20 –ú–ë)
                </div>
            </div>
            <input type="file" id="fileInput" multiple accept=".docx,.pdf,.jpg,.jpeg,.png" style="display: none;">

            <div class="file-list" id="fileList"></div>

            <div id="contentPreview" class="content-preview" style="display: none;">
                <div class="content-preview-title">üìÑ –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</div>
                <div class="content-preview-text" id="contentPreviewText"></div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" id="generateQuestionsBtn" disabled>
                    ‚ú® –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã
                </button>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
        <div class="card" id="loadingQuestions">
            <div class="loading active">
                <div class="spinner"></div>
                <div class="loading-text">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –≥–æ—Ç–æ–≤–∏–º –≤–æ–ø—Ä–æ—Å—ã...</div>
                <div style="color: #718096; font-size: 14px; margin-top: 8px;">
                    –ò–∑—É—á–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ–∫—Å—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
        <div class="card" id="step2">
            <div class="card-title">–®–∞–≥ 2. –í—ã–±–µ—Ä–∏—Ç–µ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã</div>
            <div class="card-subtitle">AI —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª <span id="questionCount"></span> –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</div>

            <div id="questionsList"></div>

            <div class="add-question">
                <input type="text" id="customQuestion" placeholder="–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –∏ –Ω–∞–∂–º–∏—Ç–µ Enter...">
            </div>

            <div class="stats" style="margin-top: 24px;">
                <div class="stat-card">
                    <div class="stat-value" id="selectedCount">0</div>
                    <div class="stat-label">–í—ã–±—Ä–∞–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="editedCount">0</div>
                    <div class="stat-label">–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="customCount">0</div>
                    <div class="stat-label">–î–æ–±–∞–≤–ª–µ–Ω–æ –≤—Ä—É—á–Ω—É—é</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" id="backToStep1">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="btn btn-primary" id="generateAnswersBtn" disabled>
                    ‚ú® –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
                </button>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ -->
        <div class="card" id="loadingAnswers">
            <div class="loading active">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="spinner"></div>
                <div class="loading-text">–ì–æ—Ç–æ–≤–∏–º –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...</div>
                <div style="color: #718096; font-size: 14px; margin-top: 8px;" id="progressText">
                    0 –∏–∑ 0
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 3: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
        <div class="card" id="step3">
            <div class="card-title">–®–∞–≥ 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
            <div class="card-subtitle">AI —Å–æ–∑–¥–∞–ª –æ—Ç–≤–µ—Ç—ã —Å —É—á—ë—Ç–æ–º —á–µ–∫-–ª–∏—Å—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ —Å—Ç–∏–ª—è Kaspi –ì–∏–¥</div>

            <div id="resultsList"></div>

            <div class="btn-group">
                <button class="btn btn-secondary" id="editAnswersBtn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
                <button class="btn btn-primary" id="toExportBtn">‚Üí –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>

        <!-- –®–∞–≥ 4: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ -->
        <div class="card" id="step4">
            <div class="card-title">–®–∞–≥ 4. –í–Ω–µ—Å–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
            <div class="card-subtitle">–£–∫–∞–∂–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, —á—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –æ—Ç–≤–µ—Ç–∞—Ö</div>

            <div id="editList"></div>

            <div class="btn-group">
                <button class="btn btn-secondary" id="backToStep3">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="btn btn-primary" id="applyEditsBtn">
                    ‚ú® –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                </button>
                <button class="btn btn-primary" id="skipToExportBtn">
                    ‚Üí –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π -->
        <div class="card" id="loadingEdits">
            <div class="loading active">
                <div class="progress-bar">
                    <div class="progress-fill" id="editProgressFill" style="width: 0%"></div>
                </div>
                <div class="spinner"></div>
                <div class="loading-text">–ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç—ã...</div>
                <div style="color: #718096; font-size: 14px; margin-top: 8px;" id="editProgressText">
                    0 –∏–∑ 0
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 5: –≠–∫—Å–ø–æ—Ä—Ç -->
        <div class="card" id="step5">
            <div class="card-title">–®–∞–≥ 5. –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</div>
            <div class="card-subtitle">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</div>

            <div class="export-area" id="exportArea"></div>

            <div class="btn-group">
                <button class="btn btn-secondary" id="copyBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-primary" id="downloadBtn">üíæ –°–∫–∞—á–∞—Ç—å .docx</button>
            </div>

            <div style="margin-top: 24px; padding: 20px; background: #f0fdf4; border-radius: 10px; border-left: 4px solid #48bb78;">
                <div style="font-weight: 600; color: #166534; margin-bottom: 8px;">‚úÖ –ì–æ—Ç–æ–≤–æ!</div>
                <div style="color: #166534; font-size: 14px;">
                    –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Å–æ–≥–ª–∞—Å—É–π—Ç–µ —Å –∑–∞–∫–∞–∑—á–∏–∫–æ–º, —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π.
                </div>
            </div>
        </div>

        <div class="notification" id="notification">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!</div>
    </div>

    <script>
        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ö–û–ù–¢–ï–ù–¢–ê ==========
        
        function analyzeContentAndGenerateQuestions(text) {
            const topics = extractTopics(text);
            const questions = [];
            
            topics.forEach(topic => {
                questions.push(...generateQuestionsForTopic(topic, text));
            });
            
            // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            return [...new Set(questions)].slice(0, 15);
        }

        function extractTopics(text) {
            const topics = [];
            const lowerText = text.toLowerCase();
            
            // –ò—â–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
            if (lowerText.includes('–Ω–∞–ª–æ–≥')) {
                topics.push('–Ω–∞–ª–æ–≥–∏');
            }
            if (lowerText.includes('–æ–ø–ª–∞—Ç') || lowerText.includes('–ø–ª–∞—Ç')) {
                topics.push('–æ–ø–ª–∞—Ç–∞');
            }
            if (lowerText.includes('–ø–æ—Ä—Ç–∞–ª') || lowerText.includes('egov')) {
                topics.push('–ø–æ—Ä—Ç–∞–ª');
            }
            if (lowerText.includes('–±–∞–Ω–∫–æ–º–∞—Ç') || lowerText.includes('–º–æ–±–∏–ª—å–Ω')) {
                topics.push('–±–∞–Ω–∫–æ–º–∞—Ç');
            }
            if (lowerText.includes('—ç—Ü–ø') || lowerText.includes('–ø–æ–¥–ø–∏—Å')) {
                topics.push('–≠–¶–ü');
            }
            if (lowerText.includes('–∏–∏–Ω') || lowerText.includes('–±–∏–Ω')) {
                topics.push('—Ä–µ–∫–≤–∏–∑–∏—Ç—ã');
            }
            if (lowerText.includes('—á–µ–∫')) {
                topics.push('—á–µ–∫');
            }
            if (lowerText.includes('–∫–∞–±–∏–Ω–µ—Ç')) {
                topics.push('–∫–∞–±–∏–Ω–µ—Ç');
            }
            if (lowerText.includes('–∫–∞—Ä—Ç')) {
                topics.push('–∫–∞—Ä—Ç–∞');
            }
            if (lowerText.includes('–±–æ–Ω—É—Å')) {
                topics.push('–±–æ–Ω—É—Å—ã');
            }
            if (lowerText.includes('–¥–µ–ø–æ–∑–∏—Ç')) {
                topics.push('–¥–µ–ø–æ–∑–∏—Ç');
            }
            if (lowerText.includes('–∫—Ä–µ–¥–∏—Ç')) {
                topics.push('–∫—Ä–µ–¥–∏—Ç');
            }
            if (lowerText.includes('–ø–µ—Ä–µ–≤–æ–¥')) {
                topics.push('–ø–µ—Ä–µ–≤–æ–¥—ã');
            }
            
            return topics.length > 0 ? topics : ['–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'];
        }

        function generateQuestionsForTopic(topic, text) {
            const questions = [];
            
            switch(topic) {
                case '–Ω–∞–ª–æ–≥–∏':
                    questions.push(
                        '–ö–∞–∫–∏–µ –Ω–∞–ª–æ–≥–∏ –º–æ–∂–Ω–æ –æ–ø–ª–∞—Ç–∏—Ç—å –æ–Ω–ª–∞–π–Ω?',
                        '–ö—Ç–æ –º–æ–∂–µ—Ç –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –Ω–∞–ª–æ–≥–∏ –æ–Ω–ª–∞–π–Ω?',
                        '–ß—Ç–æ –º–æ–∂–Ω–æ –æ–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–æ–º–µ –Ω–∞–ª–æ–≥–æ–≤?',
                        '–ö–∞–∫–∏–µ –µ—Å—Ç—å —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –Ω–∞–ª–æ–≥–æ–≤?'
                    );
                    break;
                case '–æ–ø–ª–∞—Ç–∞':
                    questions.push(
                        '–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥–∏ –æ–Ω–ª–∞–π–Ω?',
                        '–ì–¥–µ –º–æ–∂–Ω–æ –æ–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥–∏?',
                        '–ö–∞–∫–∏–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã?',
                        '–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –æ–ø–ª–∞—Ç–∞?'
                    );
                    break;
                case '–ø–æ—Ä—Ç–∞–ª':
                    questions.push(
                        '–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥–∏ —á–µ—Ä–µ–∑ egov.kz?',
                        '–ù—É–∂–Ω–∞ –ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø–æ—Ä—Ç–∞–ª–µ egov.kz?',
                        '–ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã –Ω–∞ –ø–æ—Ä—Ç–∞–ª–µ?',
                        '–ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –ø–æ—Ä—Ç–∞–ª–µ egov.kz?'
                    );
                    break;
                case '–±–∞–Ω–∫–æ–º–∞—Ç':
                    questions.push(
                        '–ú–æ–∂–Ω–æ –ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥–∏ —á–µ—Ä–µ–∑ –±–∞–Ω–∫–æ–º–∞—Ç?',
                        '–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞?',
                        '–ö–∞–∫–∏–µ –±–∞–Ω–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ–ø–ª–∞—Ç—É –Ω–∞–ª–æ–≥–æ–≤?'
                    );
                    break;
                case '–≠–¶–ü':
                    questions.push(
                        '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ª–∏ –∏–º–µ—Ç—å –≠–¶–ü –¥–ª—è –æ–ø–ª–∞—Ç—ã –Ω–∞–ª–æ–≥–æ–≤?',
                        '–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å –≠–¶–ü?',
                        '–ú–æ–∂–Ω–æ –ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å –±–µ–∑ –≠–¶–ü?'
                    );
                    break;
                case '—Ä–µ–∫–≤–∏–∑–∏—Ç—ã':
                    questions.push(
                        '–ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã –Ω–∞–ª–æ–≥–æ–≤?',
                        '–ì–¥–µ –Ω–∞–π—Ç–∏ –∫–æ–¥ –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –æ—Ä–≥–∞–Ω–∞?',
                        '–ù—É–∂–µ–Ω –ª–∏ –ò–ò–ù –¥–ª—è –æ–ø–ª–∞—Ç—ã –Ω–∞–ª–æ–≥–æ–≤?'
                    );
                    break;
                case '—á–µ–∫':
                    questions.push(
                        '–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ –Ω–∞–ª–æ–≥–∞?',
                        '–ò–º–µ–µ—Ç –ª–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π —á–µ–∫ —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é —Å–∏–ª—É?',
                        '–ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π?'
                    );
                    break;
                case '–∫–∞–±–∏–Ω–µ—Ç':
                    questions.push(
                        '–ß—Ç–æ —Ç–∞–∫–æ–µ –ö–∞–±–∏–Ω–µ—Ç –Ω–∞–ª–æ–≥–æ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞?',
                        '–ö–∞–∫ –∑–∞–π—Ç–∏ –≤ –ö–∞–±–∏–Ω–µ—Ç –Ω–∞–ª–æ–≥–æ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞?',
                        '–ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ö–∞–±–∏–Ω–µ—Ç–µ?'
                    );
                    break;
                case '–∫–∞—Ä—Ç–∞':
                    questions.push(
                        '–ö–∞–∫–∞—è –∫–∞—Ä—Ç–∞ –Ω—É–∂–Ω–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã?',
                        '–ú–æ–∂–Ω–æ –ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π –ª—é–±–æ–≥–æ –±–∞–Ω–∫–∞?',
                        '–ö–∞–∫–∏–µ –∫–∞—Ä—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –¥–ª—è –æ–ø–ª–∞—Ç—ã?'
                    );
                    break;
                case '–±–æ–Ω—É—Å—ã':
                    questions.push(
                        '–ß—Ç–æ —Ç–∞–∫–æ–µ Kaspi –ë–æ–Ω—É—Å?',
                        '–ö–∞–∫ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –±–æ–Ω—É—Å—ã?',
                        '–ì–¥–µ –º–æ–∂–Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–æ–Ω—É—Å—ã?',
                        '–ö–∞–∫–æ–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –±–æ–Ω—É—Å–æ–≤?'
                    );
                    break;
                case '–¥–µ–ø–æ–∑–∏—Ç':
                    questions.push(
                        '–ß—Ç–æ —Ç–∞–∫–æ–µ Kaspi –î–µ–ø–æ–∑–∏—Ç?',
                        '–ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –ø–æ –¥–µ–ø–æ–∑–∏—Ç—É?',
                        '–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –¥–µ–ø–æ–∑–∏—Ç?'
                    );
                    break;
                case '–∫—Ä–µ–¥–∏—Ç':
                    questions.push(
                        '–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫—Ä–µ–¥–∏—Ç?',
                        '–ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è?',
                        '–ö—Ç–æ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∫—Ä–µ–¥–∏—Ç?'
                    );
                    break;
                case '–ø–µ—Ä–µ–≤–æ–¥—ã':
                    questions.push(
                        '–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥?',
                        '–ö–∞–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –∑–∞ –ø–µ—Ä–µ–≤–æ–¥—ã?',
                        '–ö–∞–∫–∏–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥—ã?'
                    );
                    break;
                default:
                    questions.push(
                        '–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?',
                        '–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è?',
                        '–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é?'
                    );
            }
            
            return questions;
        }

        function generateAnswersFromContent(questions, sourceText) {
            const answers = {};
            
            questions.forEach(question => {
                answers[question] = generateAnswerForQuestion(question, sourceText);
            });
            
            return answers;
        }

        function generateAnswerForQuestion(question, text) {
            const lowerQ = question.toLowerCase();
            
            // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 20);
            const relevantSentences = [];
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ –≤–æ–ø—Ä–æ—Å–∞
            const keywords = extractKeywords(question);
            
            // –ò—â–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
            sentences.forEach(sentence => {
                const lowerSentence = sentence.toLowerCase();
                let matchCount = 0;
                
                keywords.forEach(kw => {
                    if (lowerSentence.includes(kw)) {
                        matchCount++;
                    }
                });
                
                if (matchCount > 0) {
                    relevantSentences.push({ 
                        sentence: sentence.trim(), 
                        relevance: matchCount 
                    });
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
            relevantSentences.sort((a, b) => b.relevance - a.relevance);
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –∏–∑ —Å–∞–º—ã—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
            if (relevantSentences.length > 0) {
                const topSentences = relevantSentences
                    .slice(0, 3)
                    .map(s => s.sentence);
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ —Å–≤—è–∑–Ω—ã–π —Ç–µ–∫—Å—Ç
                let answer = topSentences.join('. ');
                if (!answer.endsWith('.')) {
                    answer += '.';
                }
                
                return answer;
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∞—Å—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            if (text.length > 300) {
                return text.substring(0, 300) + '...';
            }
            
            return text;
        }

        function extractKeywords(question) {
            const stopWords = ['–∫–∞–∫', '—á—Ç–æ', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '–º–æ–∂–Ω–æ', '–Ω—É–∂–Ω–æ', '–ª–∏', 
                              '–¥–ª—è', '—á–µ—Ä–µ–∑', '–Ω–∞', '–≤', '–∫–∞–∫–∏–µ', '–∫–∞–∫–∞—è', '–∫–∞–∫–æ–π',
                              '–µ—Å—Ç—å', '—ç—Ç–æ', '–∏–ª–∏', '–∏', '–∞', '–Ω–æ'];
            
            return question.toLowerCase()
                .replace(/[?!.,]/g, '')
                .split(/\s+/)
                .filter(word => word.length > 2 && !stopWords.includes(word));
        }

        // ========== –°–û–°–¢–û–Ø–ù–ò–ï –ò UI ==========
        
        let state = {
            sourceText: '',
            files: [],
            questions: [],
            selectedQuestions: new Set(),
            editedQuestions: new Set(),
            customQuestions: 0,
            qaData: {},
            editComments: {}
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const infoText = document.getElementById('infoText');
        const generateQuestionsBtn = document.getElementById('generateQuestionsBtn');
        const contentPreview = document.getElementById('contentPreview');
        const contentPreviewText = document.getElementById('contentPreviewText');

        // –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        infoText.addEventListener('input', () => {
            state.sourceText = infoText.value;
            updateContentPreview();
            checkStep1();
        });

        function updateContentPreview() {
            if (state.sourceText.trim().length > 0) {
                contentPreview.style.display = 'block';
                const preview = state.sourceText.length > 500 
                    ? state.sourceText.substring(0, 500) + '...' 
                    : state.sourceText;
                contentPreviewText.textContent = preview;
            } else {
                contentPreview.style.display = 'none';
            }
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (state.files.length >= 20) {
                    alert('–ú–∞–∫—Å–∏–º—É–º 20 —Ñ–∞–π–ª–æ–≤');
                    return;
                }

                const isDoc = file.name.endsWith('.docx') || file.name.endsWith('.pdf');
                const isImage = file.name.endsWith('.jpg') || file.name.endsWith('.jpeg') || file.name.endsWith('.png');
                
                const maxSize = isDoc ? 10 * 1024 * 1024 : 20 * 1024 * 1024;
                
                if (file.size > maxSize) {
                    alert(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π`);
                    return;
                }

                if (!isDoc && !isImage) {
                    alert(`–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ ${file.name} –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è`);
                    return;
                }

                state.files.push(file);
                addFileToList(file);
            });
            checkStep1();
        }

        function addFileToList(file) {
            const item = document.createElement('div');
            item.className = 'file-item';
            item.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">${getFileIcon(file.name)}</div>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                </div>
                <button class="remove-btn" onclick="removeFile('${file.name}')">‚úï</button>
            `;
            fileList.appendChild(item);
        }

        function getFileIcon(filename) {
            if (filename.endsWith('.docx')) return 'üìÑ';
            if (filename.endsWith('.pdf')) return 'üìï';
            if (filename.endsWith('.jpg') || filename.endsWith('.jpeg') || filename.endsWith('.png')) return 'üñºÔ∏è';
            return 'üìé';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        window.removeFile = function(filename) {
            state.files = state.files.filter(f => f.name !== filename);
            renderFileList();
            checkStep1();
        }

        function renderFileList() {
            fileList.innerHTML = '';
            state.files.forEach(file => addFileToList(file));
        }

        function checkStep1() {
            const hasContent = state.sourceText.trim().length > 0 || state.files.length > 0;
            generateQuestionsBtn.disabled = !hasContent;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤
        generateQuestionsBtn.addEventListener('click', () => {
            if (!state.sourceText.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π');
                return;
            }
            
            showCard('loadingQuestions');
            
            setTimeout(() => {
                state.questions = analyzeContentAndGenerateQuestions(state.sourceText);
                state.selectedQuestions = new Set(state.questions.map((_, i) => i));
                renderQuestions();
                showCard('step2');
            }, 2000);
        });

        function renderQuestions() {
            const list = document.getElementById('questionsList');
            list.innerHTML = '';
            
            state.questions.forEach((q, index) => {
                const item = document.createElement('div');
                item.className = 'question-item';
                item.innerHTML = `
                    <input type="checkbox" class="checkbox" ${state.selectedQuestions.has(index) ? 'checked' : ''} 
                           onchange="toggleQuestion(${index})">
                    <div class="question-content">
                        <span class="question-number">${index + 1}.</span>
                        <span class="question-text" onclick="editQuestion(${index})">${q}</span>
                        ${state.editedQuestions.has(index) ? '<span class="edit-icon">‚úèÔ∏è</span>' : ''}
                    </div>
                `;
                list.appendChild(item);
            });

            document.getElementById('questionCount').textContent = state.questions.length;
            updateStats();
        }

        window.toggleQuestion = function(index) {
            if (state.selectedQuestions.has(index)) {
                state.selectedQuestions.delete(index);
            } else {
                state.selectedQuestions.add(index);
            }
            updateStats();
            document.getElementById('generateAnswersBtn').disabled = state.selectedQuestions.size === 0;
        }

        window.editQuestion = function(index) {
            const item = document.querySelectorAll('.question-item')[index];
            const content = item.querySelector('.question-content');
            const currentText = state.questions[index];
            
            content.innerHTML = `
                <input type="text" class="question-input" value="${currentText}" 
                       onblur="saveQuestion(${index}, this.value)"
                       onkeypress="if(event.key === 'Enter') saveQuestion(${index}, this.value)">
            `;
            content.querySelector('input').focus();
        }

        window.saveQuestion = function(index, newText) {
            if (newText.trim() && newText !== state.questions[index]) {
                state.questions[index] = newText.trim();
                state.editedQuestions.add(index);
            }
            renderQuestions();
        }

        document.getElementById('customQuestion').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.target.value.trim()) {
                state.questions.push(e.target.value.trim());
                const newIndex = state.questions.length - 1;
                state.selectedQuestions.add(newIndex);
                state.customQuestions++;
                e.target.value = '';
                renderQuestions();
            }
        });

        function updateStats() {
            document.getElementById('selectedCount').textContent = state.selectedQuestions.size;
            document.getElementById('editedCount').textContent = state.editedQuestions.size;
            document.getElementById('customCount').textContent = state.customQuestions;
        }

        document.getElementById('backToStep1').addEventListener('click', () => showCard('step1'));
        document.getElementById('generateAnswersBtn').addEventListener('click', generateAnswers);

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
        function generateAnswers() {
            showCard('loadingAnswers');
            
            const selected = Array.from(state.selectedQuestions);
            let processed = 0;
            const total = selected.length;
            
            const interval = setInterval(() => {
                processed++;
                const progress = (processed / total) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressText').textContent = `${processed} –∏–∑ ${total}`;
                
                if (processed >= total) {
                    clearInterval(interval);
                    setTimeout(() => {
                        generateQAData();
                        renderResults();
                        showCard('step3');
                    }, 500);
                }
            }, 200);
        }

        function generateQAData() {
            const selectedQuestions = Array.from(state.selectedQuestions).map(i => state.questions[i]);
            state.qaData = generateAnswersFromContent(selectedQuestions, state.sourceText);
        }

        function renderResults() {
            const list = document.getElementById('resultsList');
            list.innerHTML = '';
            
            Object.entries(state.qaData).forEach(([question, answer]) => {
                const pair = document.createElement('div');
                pair.className = 'qa-pair';
                pair.innerHTML = `
                    <div class="qa-question">${question}</div>
                    <div class="qa-answer">${answer}</div>
                `;
                list.appendChild(pair);
            });
        }

        document.getElementById('editAnswersBtn').addEventListener('click', () => {
            renderEditList();
            showCard('step4');
        });

        document.getElementById('toExportBtn').addEventListener('click', () => {
            renderExport();
            showCard('step5');
        });

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
        function renderEditList() {
            const list = document.getElementById('editList');
            list.innerHTML = '';
            
            Object.entries(state.qaData).forEach(([question, answer]) => {
                const pair = document.createElement('div');
                pair.className = 'qa-pair';
                pair.innerHTML = `
                    <div class="qa-question">${question}</div>
                    <div class="qa-answer">${answer}</div>
                    <div class="edit-section">
                        <label class="edit-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –≤—Å—ë —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç)</label>
                        <textarea class="edit-textarea" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ä–æ–∫–∞—Ö, –£–ø—Ä–æ—Å—Ç–∏—Ç–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É, –£–±–µ—Ä–∏—Ç–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ..." 
                                  onchange="saveComment('${question.replace(/'/g, "\\'")}', this.value)"></textarea>
                    </div>
                `;
                list.appendChild(pair);
            });
        }

        window.saveComment = function(question, comment) {
            if (comment.trim()) {
                state.editComments[question] = comment;
            } else {
                delete state.editComments[question];
            }
        }

        document.getElementById('backToStep3').addEventListener('click', () => {
            renderResults();
            showCard('step3');
        });

        document.getElementById('applyEditsBtn').addEventListener('click', () => {
            const commentsCount = Object.keys(state.editComments).length;
            if (commentsCount === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ—Ç–≤–µ—Ç–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å');
                return;
            }

            showCard('loadingEdits');
            
            let processed = 0;
            const total = commentsCount;
            
            const interval = setInterval(() => {
                processed++;
                const progress = (processed / total) * 100;
                document.getElementById('editProgressFill').style.width = progress + '%';
                document.getElementById('editProgressText').textContent = `${processed} –∏–∑ ${total}`;
                
                if (processed >= total) {
                    clearInterval(interval);
                    setTimeout(() => {
                        applyEdits();
                        renderResults();
                        showCard('step3');
                    }, 500);
                }
            }, 300);
        });

        function applyEdits() {
            Object.entries(state.editComments).forEach(([question, comment]) => {
                state.qaData[question] = state.qaData[question] + 
                    `\n\n[–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å —É—á—ë—Ç–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è: "${comment}"]`;
            });
            state.editComments = {};
        }

        document.getElementById('skipToExportBtn').addEventListener('click', () => {
            renderExport();
            showCard('step5');
        });

        // –≠–∫—Å–ø–æ—Ä—Ç
        function renderExport() {
            const area = document.getElementById('exportArea');
            let html = '';
            
            Object.entries(state.qaData).forEach(([question, answer], index) => {
                html += `
                    <div class="qa-pair">
                        <div class="qa-question">${index + 1}. ${question}</div>
                        <div class="qa-answer">${answer}</div>
                    </div>
                `;
            });
            
            area.innerHTML = html;
        }

        document.getElementById('copyBtn').addEventListener('click', () => {
            let text = '';
            Object.entries(state.qaData).forEach(([question, answer], index) => {
                text += `${index + 1}. ${question}\n\n${answer}\n\n---\n\n`;
            });
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification();
            });
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const today = new Date().toISOString().split('T')[0];
            alert(`–§–∞–π–ª "Kaspi –ì–∏–¥_–í–æ–ø—Ä–æ—Å—ã_${today}.docx" –±—ã–ª –±—ã —Å–∫–∞—á–∞–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏`);
            showNotification('–§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é!');
        });

        function showNotification(text = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!') {
            const notification = document.getElementById('notification');
            notification.textContent = text;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
        function showCard(cardId) {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(cardId).classList.add('active');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        checkStep1();
    </script>
</body>
</html>